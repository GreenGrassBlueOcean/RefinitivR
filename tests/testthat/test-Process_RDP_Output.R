test_that("Process_RDP_output works",{

  path = "PY_get_search_metadata_input.py"
  PY_get_search_metadata_input <- reticulate::r_to_py(reticulate::py_load_object(file = path))
  r_df <- Process_RDP_output(PY_get_search_metadata_input)

  expect_equal(head(r_df, n=10)
               , structure(list(Refinitiv_index = c("AAACurrencyBondBenchmarkChain", "AACurrencyBondBenchmarkChain", "ABSMBSBondsRIC", "ActiveEstimatesExist",
                                                    "ActivityDate", "ACurrencyBondBenchmarkChain", "AdmissionToTrading", "ADRType", "ADRTypeName", "Adxr14D")
                                , Type = c("String", "String", "String", "Boolean", "Date", "String", "Date", "String", "String", "Double")
                                , Searchable = c(FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE)
                                , Sortable = c(FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, TRUE)
                                , Navigable = c(FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, TRUE, FALSE, FALSE, TRUE)
                                , Groupable = c(FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE)
                                , Exact = c(FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE)
                                , Symbol = c(FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE))
                           , row.names = c(NA, 10L), class = "data.frame")
  )
})


test_that("Process_RDP_output works",{
  path = "rd_gethistorytest.py"
  rd_gethistorytest_input <- reticulate::r_to_py(reticulate::py_load_object(file = path))

    r_df <- Process_RDP_output(rd_gethistorytest_input)

  expect_equal(r_df
            ,structure(list(Date = structure(c(1578268800, 1578355200, 1578441600,
                                               1578528000, 1578614400, 1578268800,
                                               1578355200, 1578441600, 1578528000,
                                               1578614400),
                                             class = c("POSIXct", "POSIXt"), tzone = "UTC"),
                            Instrument = c("AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                           "III.L", "III.L", "III.L", "III.L", "III.L"),
                            variable = c("Close Price", "Close Price", "Close Price",
                                         "Close Price", "Close Price", "Close Price", "Close Price",
                                         "Close Price", "Close Price", "Close Price")
                            , value = c(299.8, 298.39, 303.19, 309.63, 310.33, 14.3323633587,
                                        14.2581559539, 14.2496038139, 14.2931800366, 14.2146364396))
                       , row.names = c(NA, -10L), class = "data.frame"))
})


test_that("Process_RDP_output works without removing NA",{
  path = "test_rd_gethistory2.py"
  rd_gethistorytest_input2 <- reticulate::r_to_py(reticulate::py_load_object(file = path))
  r_df <- Process_RDP_output(rd_gethistorytest_input2, RemoveNA = FALSE)

  CorrectOuput <- structure(list(Date = structure(c(1601510400, 1603756800, 1603843200,
                                                    1603929600, 1604016000, 1604188800, 1604275200, 1604361600, 1604448000,
                                                    1604534400, 1604620800, 1604880000, 1604966400, 1605052800, 1605139200,
                                                    1605225600, 1605484800, 1605571200, 1605657600, 1605744000, 1605830400,
                                                    1606089600, 1606176000, 1606262400, 1606348800, 1606435200, 1606694400,
                                                    1606780800, 1601510400, 1603756800, 1603843200, 1603929600, 1604016000,
                                                    1604188800, 1604275200, 1604361600, 1604448000, 1604534400, 1604620800,
                                                    1604880000, 1604966400, 1605052800, 1605139200, 1605225600, 1605484800,
                                                    1605571200, 1605657600, 1605744000, 1605830400, 1606089600, 1606176000,
                                                    1606262400, 1606348800, 1606435200, 1606694400, 1606780800, 1601510400,
                                                    1603756800, 1603843200, 1603929600, 1604016000, 1604188800, 1604275200,
                                                    1604361600, 1604448000, 1604534400, 1604620800, 1604880000, 1604966400,
                                                    1605052800, 1605139200, 1605225600, 1605484800, 1605571200, 1605657600,
                                                    1605744000, 1605830400, 1606089600, 1606176000, 1606262400, 1606348800,
                                                    1606435200, 1606694400, 1606780800, 1601510400, 1603756800, 1603843200,
                                                    1603929600, 1604016000, 1604188800, 1604275200, 1604361600, 1604448000,
                                                    1604534400, 1604620800, 1604880000, 1604966400, 1605052800, 1605139200,
                                                    1605225600, 1605484800, 1605571200, 1605657600, 1605744000, 1605830400,
                                                    1606089600, 1606176000, 1606262400, 1606348800, 1606435200, 1606694400,
                                                    1606780800, 1601510400, 1603756800, 1603843200, 1603929600, 1604016000,
                                                    1604188800, 1604275200, 1604361600, 1604448000, 1604534400, 1604620800,
                                                    1604880000, 1604966400, 1605052800, 1605139200, 1605225600, 1605484800,
                                                    1605571200, 1605657600, 1605744000, 1605830400, 1606089600, 1606176000,
                                                    1606262400, 1606348800, 1606435200, 1606694400, 1606780800, 1601510400,
                                                    1603756800, 1603843200, 1603929600, 1604016000, 1604188800, 1604275200,
                                                    1604361600, 1604448000, 1604534400, 1604620800, 1604880000, 1604966400,
                                                    1605052800, 1605139200, 1605225600, 1605484800, 1605571200, 1605657600,
                                                    1605744000, 1605830400, 1606089600, 1606176000, 1606262400, 1606348800,
                                                    1606435200, 1606694400, 1606780800, 1601510400, 1603756800, 1603843200,
                                                    1603929600, 1604016000, 1604188800, 1604275200, 1604361600, 1604448000,
                                                    1604534400, 1604620800, 1604880000, 1604966400, 1605052800, 1605139200,
                                                    1605225600, 1605484800, 1605571200, 1605657600, 1605744000, 1605830400,
                                                    1606089600, 1606176000, 1606262400, 1606348800, 1606435200, 1606694400,
                                                    1606780800, 1601510400, 1603756800, 1603843200, 1603929600, 1604016000,
                                                    1604188800, 1604275200, 1604361600, 1604448000, 1604534400, 1604620800,
                                                    1604880000, 1604966400, 1605052800, 1605139200, 1605225600, 1605484800,
                                                    1605571200, 1605657600, 1605744000, 1605830400, 1606089600, 1606176000,
                                                    1606262400, 1606348800, 1606435200, 1606694400, 1606780800),
                                                  class = c("POSIXct", "POSIXt"), tzone = "UTC"),
                                 Instrument = c("VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                                                "VOD.L", "VOD.L", "VOD.L", "VOD.L", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                                                "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O")
                                 , variable = c("Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
                                                "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
                                                "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
                                                "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
                                                "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
                                                "Close Price", "Close Price", "Close Price", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
                                                "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Free Float (Percent)", "Free Float (Percent)", "Free Float (Percent)",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
                                                "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
                                                "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
                                                "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
                                                "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
                                                "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
                                                "Close Price", "Close Price", "Close Price"),
                                 value = c(NA, 37103.8780069942, 35896.1371524315, 35897.0160708866, 35764.7450389005, NA, 36724.4581312381,
                                           37195.8088771418, 37064.2925047356, 37413.6875834056, 37079.3743603899,
                                           39592.40654969, 41548.5399875809, 41540.9793264077, 41613.0334291565,
                                           42287.0942747541, 45226.8402111319, 43536.4259648729, 43792.0525581842,
                                           43289.1203852046, 43899.243207155, 43605.9519383503, 44910.6439515686,
                                           44653.6842132482, 45036.6487984347, 44619.4886953427, 44210.4110910996,
                                           45155.9398190853, 99.7444, NA, NA, NA, NA, 99.7442, NA, NA, NA,
                                           NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,
                                           NA, NA, 99.8256, NA, 26831892.312, 26831892.312, 26831892.312,
                                           26831892.312, NA, 26832067.065, 26832067.065, 26832067.065, 26832067.065,
                                           26832067.065, 26832067.065, 26832067.065, 26832067.065, 26832067.065,
                                           26832067.065, 26832067.065, 26832067.065, 26832067.065, 26832067.065,
                                           26832067.065, 26832067.065, 26832067.065, 26832067.065, 26832067.065,
                                           26832067.065, 26834018.032, 26834018.032, NA, 1.3828274792, 1.337816086,
                                           1.3378488425, 1.3329192225, NA, 1.3686779346, 1.3862446299, 1.3813431673,
                                           1.3943647164, 1.3819052506, 1.4755630438, 1.5484658669, 1.5481840898,
                                           1.5508694626, 1.575990928, 1.6855518474, 1.6225520702, 1.6320789767,
                                           1.6133352783, 1.6360738478, 1.6251432226, 1.6737675798, 1.6641909885,
                                           1.6784636342, 1.6629165613, 1.6475509198, 1.6827871162, NA, 1982410.1132,
                                           1890600.3824, 1960647.80664, 1850816.16572, NA, 1849286.00354,
                                           1877679.01288, 1954357.1399, 2023724.49206, 2017943.87938, 1977649.60864,
                                           1971698.97794, 2031545.32098, 2026784.81642, 2027634.90652, 2045316.7806,
                                           2029845.14078, 2006722.69006, 2017093.78928, 1994991.44668, 1935655.1577,
                                           1958097.53634, 1972719.08606, NA, 1982240.09518, 2024064.5281,
                                           2086461.14144, 99.9315, NA, NA, NA, NA, 99.9313, NA, NA, NA,
                                           NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,
                                           NA, NA, 99.9208, NA, 17001802, 17001802, 17001802, 17001802,
                                           NA, 17001802, 17001802, 17001802, 17001802, 17001802, 17001802,
                                           17001802, 17001802, 17001802, 17001802, 17001802, 17001802, 17001802,
                                           17001802, 17001802, 17001802, 17001802, 17001802, NA, 17001802,
                                           17001802, 17001802, NA, 116.6, 111.2, 115.32, 108.86, NA, 108.77,
                                           110.44, 114.95, 119.03, 118.69, 116.32, 115.97, 119.49, 119.21,
                                           119.26, 120.3, 119.39, 118.03, 118.64, 117.34, 113.85, 115.17,
                                           116.03, NA, 116.59, 119.05, 122.72)),
                            row.names = c(NA, -224L), class = "data.frame")
 expect_equal(r_df, CorrectOuput)
})

test_that("Process_RDP_output works with removing NA",{
  path = "test_rd_gethistory2.py"
  rd_gethistorytest_input2 <- reticulate::r_to_py(reticulate::py_load_object(file = path))


  r_df <- Process_RDP_output(rd_gethistorytest_input2, RemoveNA = TRUE)


  CorrectOuput <- structure(list(Date = structure(c(1603756800, 1603843200, 1603929600,
                                    1604016000, 1604275200, 1604361600, 1604448000, 1604534400, 1604620800,
                                    1604880000, 1604966400, 1605052800, 1605139200, 1605225600, 1605484800,
                                    1605571200, 1605657600, 1605744000, 1605830400, 1606089600, 1606176000,
                                    1606262400, 1606348800, 1606435200, 1606694400, 1606780800, 1601510400,
                                    1604188800, 1606780800, 1603756800, 1603843200, 1603929600, 1604016000,
                                    1604275200, 1604361600, 1604448000, 1604534400, 1604620800, 1604880000,
                                    1604966400, 1605052800, 1605139200, 1605225600, 1605484800, 1605571200,
                                    1605657600, 1605744000, 1605830400, 1606089600, 1606176000, 1606262400,
                                    1606348800, 1606435200, 1606694400, 1606780800, 1603756800, 1603843200,
                                    1603929600, 1604016000, 1604275200, 1604361600, 1604448000, 1604534400,
                                    1604620800, 1604880000, 1604966400, 1605052800, 1605139200, 1605225600,
                                    1605484800, 1605571200, 1605657600, 1605744000, 1605830400, 1606089600,
                                    1606176000, 1606262400, 1606348800, 1606435200, 1606694400, 1606780800,
                                    1603756800, 1603843200, 1603929600, 1604016000, 1604275200, 1604361600,
                                    1604448000, 1604534400, 1604620800, 1604880000, 1604966400, 1605052800,
                                    1605139200, 1605225600, 1605484800, 1605571200, 1605657600, 1605744000,
                                    1605830400, 1606089600, 1606176000, 1606262400, 1606435200, 1606694400,
                                    1606780800, 1601510400, 1604188800, 1606780800, 1603756800, 1603843200,
                                    1603929600, 1604016000, 1604275200, 1604361600, 1604448000, 1604534400,
                                    1604620800, 1604880000, 1604966400, 1605052800, 1605139200, 1605225600,
                                    1605484800, 1605571200, 1605657600, 1605744000, 1605830400, 1606089600,
                                    1606176000, 1606262400, 1606435200, 1606694400, 1606780800, 1603756800,
                                    1603843200, 1603929600, 1604016000, 1604275200, 1604361600, 1604448000,
                                    1604534400, 1604620800, 1604880000, 1604966400, 1605052800, 1605139200,
                                    1605225600, 1605484800, 1605571200, 1605657600, 1605744000, 1605830400,
                                    1606089600, 1606176000, 1606262400, 1606435200, 1606694400, 1606780800
  ), class = c("POSIXct", "POSIXt"), tzone = "UTC"),
  Instrument = c("VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L", "VOD.L",
                 "VOD.L", "VOD.L", "VOD.L", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O",
                 "AAPL.O", "AAPL.O", "AAPL.O", "AAPL.O"),
  variable = c("Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Free Float (Percent)", "Free Float (Percent)",
               "Free Float (Percent)", "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
               "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
               "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
               "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
               "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
               "Close Price", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Issue Market Cap", "Issue Market Cap",
               "Issue Market Cap", "Issue Market Cap", "Free Float (Percent)",
               "Free Float (Percent)", "Free Float (Percent)", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Issue Default Shares Outstanding", "Issue Default Shares Outstanding",
               "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
               "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
               "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
               "Close Price", "Close Price", "Close Price", "Close Price", "Close Price",
               "Close Price", "Close Price", "Close Price", "Close Price", "Close Price"),
  value = c(37103.8780069942, 35896.1371524315, 35897.0160708866,
            35764.7450389005, 36724.4581312381, 37195.8088771418, 37064.2925047356,
            37413.6875834056, 37079.3743603899, 39592.40654969, 41548.5399875809,
            41540.9793264077, 41613.0334291565, 42287.0942747541, 45226.8402111319,
            43536.4259648729, 43792.0525581842, 43289.1203852046, 43899.243207155,
            43605.9519383503, 44910.6439515686, 44653.6842132482, 45036.6487984347,
            44619.4886953427, 44210.4110910996, 45155.9398190853, 99.7444,
            99.7442, 99.8256, 26831892.312, 26831892.312, 26831892.312, 26831892.312,
            26832067.065, 26832067.065, 26832067.065, 26832067.065, 26832067.065,
            26832067.065, 26832067.065, 26832067.065, 26832067.065, 26832067.065,
            26832067.065, 26832067.065, 26832067.065, 26832067.065, 26832067.065,
            26832067.065, 26832067.065, 26832067.065, 26832067.065, 26832067.065,
            26834018.032, 26834018.032, 1.3828274792, 1.337816086, 1.3378488425,
            1.3329192225, 1.3686779346, 1.3862446299, 1.3813431673, 1.3943647164,
            1.3819052506, 1.4755630438, 1.5484658669, 1.5481840898, 1.5508694626,
            1.575990928, 1.6855518474, 1.6225520702, 1.6320789767, 1.6133352783,
            1.6360738478, 1.6251432226, 1.6737675798, 1.6641909885, 1.6784636342,
            1.6629165613, 1.6475509198, 1.6827871162, 1982410.1132, 1890600.3824,
            1960647.80664, 1850816.16572, 1849286.00354, 1877679.01288, 1954357.1399,
            2023724.49206, 2017943.87938, 1977649.60864, 1971698.97794, 2031545.32098,
            2026784.81642, 2027634.90652, 2045316.7806, 2029845.14078, 2006722.69006,
            2017093.78928, 1994991.44668, 1935655.1577, 1958097.53634, 1972719.08606,
            1982240.09518, 2024064.5281, 2086461.14144, 99.9315, 99.9313,
            99.9208, 17001802, 17001802, 17001802, 17001802, 17001802, 17001802,
            17001802, 17001802, 17001802, 17001802, 17001802, 17001802, 17001802,
            17001802, 17001802, 17001802, 17001802, 17001802, 17001802, 17001802,
            17001802, 17001802, 17001802, 17001802, 17001802, 116.6, 111.2,
            115.32, 108.86, 108.77, 110.44, 114.95, 119.03, 118.69, 116.32,
            115.97, 119.49, 119.21, 119.26, 120.3, 119.39, 118.03, 118.64,
            117.34, 113.85, 115.17, 116.03, 116.59, 119.05, 122.72)),
  row.names = c(NA, -159L), class = "data.frame")

  expect_equal(r_df, CorrectOuput)
})

